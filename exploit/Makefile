PYTHON_EXTENSION_SUFFIX = $(shell python3-config --extension-suffix)

all: sploit.pdf

jbjbarith$(PYTHON_EXTENSION_SUFFIX): jbig2arith.cc jbig2arith.h jbjbarith.cc jbjbarith.h
	g++ -O3 -std=c++20 -shared -fPIC $^ -o$@ $(shell python3-config --includes)

sploit.sym: jbjbarith$(PYTHON_EXTENSION_SUFFIX) sploit.py jbig2.py
	python3 sploit.py

sploit.0000: sploit.sym

sploit.pdf: pdf.py sploit.0000 sploit.sym
	python2 pdf.py sploit > $@

.PHONY: clean

clean:
	rm -f *.pdf *.sym *.0000 *.so
